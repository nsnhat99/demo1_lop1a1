
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thiệp Mời | CLB Hè & Đón Lớp 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
        }

        /* Animated background */
        .animated-bg {
            background: linear-gradient(-45deg, #f8d5a3, #fceec5, #a3d5f8, #c5fcee);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating shapes */
        .floating-shapes {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .floating-shapes li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            animation: float-up 25s linear infinite;
            bottom: -150px;
            border-radius: 50%;
        }

        .floating-shapes li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .floating-shapes li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .floating-shapes li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .floating-shapes li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .floating-shapes li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .floating-shapes li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .floating-shapes li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .floating-shapes li:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .floating-shapes li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .floating-shapes li:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes float-up {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
    <!-- React and Babel for in-browser JSX compilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // Helper component to wrap image-based pages for consistent styling
        const PageWrapper = ({ children }) => (
            <div className="w-full flex justify-center p-4 sm:p-0">
                <div className="max-w-xl w-full rounded-lg overflow-hidden shadow-xl bg-white">
                    {children}
                </div>
            </div>
        );

        // Helper component for simple image pages
        const ImagePage = ({ src, alt }) => (
            <PageWrapper>
                <img src={src} alt={alt} className="w-full h-auto block" />
            </PageWrapper>
        );

        const App = () => {
            // URLs for the invitation images.
            const invitationImageUrl1 = 'https://i.postimg.cc/X74PMhp9/1.jpg';
            const invitationImageUrl2 = 'https://i.postimg.cc/pXC6PZF4/2.jpg';
            const invitationImageUrl3 = 'https://i.postimg.cc/pL04JZVz/3.jpg';
            const invitationImageUrl4 = 'https://i.postimg.cc/g0n5SZr5/4.jpg';
            const invitationImageUrl5 = 'https://i.postimg.cc/xT3WcQWs/5.jpg';
            const invitationImageUrl6 = 'https://i.postimg.cc/y862R5K7/6.jpg';
            const invitationImageUrl7 = 'https://i.postimg.cc/wBZrSjmB/7.jpg';
            const invitationImageUrl9 = 'https://i.postimg.cc/4yTSx2wk/9.jpg';
            const invitationImageUrl10 = 'https://i.postimg.cc/4ybF7vFK/10.jpg';
            const invitationImageUrl11 = 'https://i.postimg.cc/DfqNMFy2/11.jpg';

            // Google Maps embed URL.
            const mapEmbedUrl = 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3723.116601956501!2d105.77663947510714!3d21.08412088058514!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135aa0e408a38a7%3A0xd008a650630d740!2zVHLGsOG7nW5nIFRp4buDdSBo4buNYyDEkMO0bmcgTmfhuqFjIEE!5e0!3m2!1sen!2sus!4v1719460515152!5m2!1sen!2sus';

            // State and handlers for forms.
            const [parentName, setParentName] = useState('');
            const [attendees, setAttendees] = useState(1);
            const [attendanceStatus, setAttendanceStatus] = useState('');
            const [isSubmittingConfirmation, setIsSubmittingConfirmation] = useState(false);
            const [confirmationSubmitted, setConfirmationSubmitted] = useState(false);
            const [confirmationError, setConfirmationError] = useState('');

            const [wish, setWish] = useState('');
            const [senderName, setSenderName] = useState('');
            const [isSubmittingWish, setIsSubmittingWish] = useState(false);
            const [wishSubmitted, setWishSubmitted] = useState(false);
            const [wishError, setWishError] = useState('');

            const scriptURL = 'https://script.google.com/a/macros/daihocthudo.edu.vn/s/AKfycbzEO4kaYJ05Zc95tET4Xzsg5MaUGYF0TPq0X-JuzF25zaW6Vi4ZR9irkqXINfKe3wDHww/exec';

            const handleConfirmationSubmit = async (e) => {
                e.preventDefault();
                if (!parentName.trim() || !attendanceStatus) {
                    setConfirmationError('Vui lòng điền tên phụ huynh và chọn trạng thái tham dự.');
                    return;
                }
                setConfirmationError('');
                setIsSubmittingConfirmation(true);
                const payload = { formType: 'confirmation', parentName, attendees, attendanceStatus };
                try {
                    const response = await fetch(scriptURL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(payload)
                    });
                    
                    const responseText = await response.text();
                    
                    if (response.ok) {
                        if (responseText.toLowerCase().includes('lỗi') || responseText.toLowerCase().includes('error') || responseText.includes("Không tìm thấy") || responseText.includes("không hợp lệ")) {
                             setConfirmationError(`Lỗi từ hệ thống: ${responseText}`);
                        } else {
                            setConfirmationSubmitted(true);
                        }
                    } else {
                        setConfirmationError(`Có lỗi xảy ra khi gửi. (Mã lỗi: ${response.status})`);
                    }
                } catch (error) {
                    console.error('Confirmation Submission Error:', error);
                    setConfirmationError('Có lỗi xảy ra, vui lòng kiểm tra kết nối mạng và thử lại.');
                } finally {
                    setIsSubmittingConfirmation(false);
                }
            };

            const handleWishSubmit = async (e) => {
                e.preventDefault();
                if (!wish.trim()) {
                    setWishError('Vui lòng nhập lời chúc của bạn.');
                    return;
                }
                setWishError('');
                setIsSubmittingWish(true);
                const payload = { formType: 'wish', wish, senderName: senderName || 'Ẩn danh' };
                try {
                     const response = await fetch(scriptURL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const responseText = await response.text();

                    if (response.ok) {
                         if (responseText.toLowerCase().includes('lỗi') || responseText.toLowerCase().includes('error') || responseText.includes("Không tìm thấy") || responseText.includes("không hợp lệ")) {
                             setWishError(`Lỗi từ hệ thống: ${responseText}`);
                        } else {
                            setWishSubmitted(true);
                        }
                    } else {
                        setWishError(`Có lỗi xảy ra khi gửi. (Mã lỗi: ${response.status})`);
                    }
                } catch (error) {
                    console.error('Wish Submission Error:', error);
                    setWishError('Có lỗi xảy ra, vui lòng kiểm tra kết nối mạng và thử lại.');
                } finally {
                    setIsSubmittingWish(false);
                }
            };

            return (
                <div className="bg-gray-100 min-h-screen">
                    <main className="flex flex-col items-center py-4 sm:py-8 space-y-4 sm:space-y-8">
                        {/* Invitation Pages */}
                        <ImagePage src={invitationImageUrl1} alt="Thiệp mời - Phần 1" />
                        <ImagePage src={invitationImageUrl2} alt="Thiệp mời - Phần 2" />
                        <ImagePage src={invitationImageUrl3} alt="Thiệp mời - Phần 3" />
                        <ImagePage src={invitationImageUrl4} alt="Thiệp mời - Phần 4" />

                        {/* Map Page */}
                        <PageWrapper>
                            <div className="relative w-full">
                                <img src={invitationImageUrl5} alt="Thiệp mời - Phần 5 - Bản đồ" className="w-full h-auto block"/>
                                <div className="absolute top-[21%] left-[13%] w-[74%] h-[54%] p-1">
                                    <iframe src={mapEmbedUrl} className="w-full h-full rounded-md shadow-lg border-2 border-amber-800/50" style={{ border: '0' }} allowFullScreen={true} loading="lazy" referrerPolicy="no-referrer-when-downgrade" title="Bản đồ đến Trường Tiểu học Đông Ngạc A"></iframe>
                                </div>
                            </div>
                        </PageWrapper>

                        <ImagePage src={invitationImageUrl6} alt="Thiệp mời - Phần 6" />
                        <ImagePage src={invitationImageUrl7} alt="Thiệp mời - Phần 7" />

                        {/* Form Section */}
                        <section className="w-full flex items-center justify-center animated-bg relative overflow-hidden py-16 px-4">
                            <ul className="floating-shapes"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>
                            <div className="relative z-10 max-w-2xl w-full mx-auto bg-white/95 p-6 sm:p-8 rounded-2xl shadow-2xl">
                                <div className="mb-10">
                                    <h2 className="text-2xl sm:text-3xl font-bold text-center text-purple-800 mb-8">Xác nhận tham dự chương trình</h2>
                                    {confirmationSubmitted ? (
                                        <div className="text-center p-6 bg-green-50 rounded-lg border border-green-200">
                                            <svg className="mx-auto h-12 w-12 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <h3 className="mt-2 text-lg font-bold text-green-800">Cảm ơn bạn đã xác nhận!</h3>
                                            <p className="mt-1 text-sm text-green-700">Chúng tôi đã nhận được thông tin của bạn.</p>
                                        </div>
                                    ) : (
                                        <form onSubmit={handleConfirmationSubmit} className="space-y-6">
                                            <div className="relative">
                                                <div className="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                                    <svg className="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                      <path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clipRule="evenodd" />
                                                    </svg>
                                                </div>
                                                <input type="text" id="parentName" value={parentName} onChange={(e) => setParentName(e.target.value)} className="block w-full rounded-md border-gray-300 py-2 pl-10 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm" placeholder="Phụ huynh em *" required />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-center text-gray-700 mb-2">Số lượng người tham dự</label>
                                                <div className="flex items-center justify-center space-x-4">
                                                    <button type="button" onClick={() => setAttendees(prev => Math.max(1, prev - 1))} className="w-10 h-10 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors disabled:opacity-50" disabled={attendees <= 1}>-</button>
                                                    <span className="text-xl font-bold text-purple-800 w-12 text-center">{attendees}</span>
                                                    <button type="button" onClick={() => setAttendees(prev => Math.min(5, prev + 1))} className="w-10 h-10 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors disabled:opacity-50" disabled={attendees >= 5}>+</button>
                                                </div>
                                            </div>
                                            <div>
                                                 <label className="block text-sm font-medium text-center text-gray-700 mb-2">Có tham dự không? <span className="text-red-500">*</span></label>
                                                 <div className="grid grid-cols-3 gap-2 sm:gap-4">
                                                     {['Có', 'Không', 'Cân nhắc'].map(option => (
                                                         <button
                                                             type="button"
                                                             key={option}
                                                             onClick={() => setAttendanceStatus(option)}
                                                             className={`py-3 px-2 rounded-lg text-sm font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500
                                                                 ${attendanceStatus === option
                                                                     ? 'bg-purple-600 text-white shadow-lg'
                                                                     : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                                 }`}
                                                         >
                                                             {option}
                                                         </button>
                                                     ))}
                                                 </div>
                                            </div>
                                            {confirmationError && <p className="text-sm text-center text-red-600">{confirmationError}</p>}
                                            <button type="submit" disabled={isSubmittingConfirmation} className="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:bg-purple-300 transition-all duration-200 transform hover:scale-105">
                                                {isSubmittingConfirmation ? 'Đang gửi...' : 'Gửi xác nhận'}
                                            </button>
                                        </form>
                                    )}
                                </div>
                                <hr className="border-t-2 border-purple-200 border-dashed my-8" />
                                <div>
                                    <h2 className="text-2xl sm:text-3xl font-bold text-center text-rose-500 mb-6">Gửi lời chúc đến chương trình</h2>
                                    {wishSubmitted ? (
                                        <div className="text-center p-4 bg-green-100 text-green-800 rounded-lg"><h3 className="font-bold text-lg">Cảm ơn lời chúc của bạn!</h3><p>Lời chúc của bạn đã được gửi đi thành công.</p></div>
                                    ) : (
                                        <form onSubmit={handleWishSubmit} className="space-y-4">
                                            <div><label htmlFor="wish" className="block text-sm font-medium text-gray-700">Lời chúc <span className="text-red-500">*</span></label><textarea id="wish" value={wish} onChange={(e) => setWish(e.target.value)} rows={4} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500 sm:text-sm" required></textarea></div>
                                            <div><label htmlFor="senderName" className="block text-sm font-medium text-gray-700">Tên người gửi <span className="text-gray-500">(tùy chọn)</span></label><input type="text" id="senderName" value={senderName} onChange={(e) => setSenderName(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rose-500 focus:ring-rose-500 sm:text-sm" /></div>
                                            {wishError && <p className="text-sm text-red-600">{wishError}</p>}
                                            <button type="submit" disabled={isSubmittingWish} className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rose-500 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 disabled:bg-rose-300">{isSubmittingWish ? 'Đang gửi...' : 'Gửi lời chúc'}</button>
                                        </form>
                                    )}
                                </div>
                            </div>
                        </section>

                        {/* Closing Pages */}
                        <ImagePage src={invitationImageUrl10} alt="Thiệp mời - Phần 10 - Mã QR Zalo" />
                        <ImagePage src={invitationImageUrl11} alt="Thiệp mời - Phần 11 - Hẹn gặp bạn" />
                        <ImagePage src={invitationImageUrl9} alt="Thiệp mời - Phần 9 - Trân trọng cảm ơn" />

                    </main>
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
</body>
</html>
